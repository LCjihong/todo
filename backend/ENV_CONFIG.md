# çŽ¯å¢ƒå˜é‡é…ç½®è¯´æ˜Ž

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Ž Todo åº”ç”¨åŽç«¯çš„æ‰€æœ‰çŽ¯å¢ƒå˜é‡é…ç½®é¡¹ã€‚

## ðŸ“‹ å¿«é€Ÿå¼€å§‹

1. å¤åˆ¶çŽ¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š
   ```bash
   cp .env.example .env
   ```

2. æ ¹æ®å®žé™…æƒ…å†µä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„é…ç½®å€¼

3. ç”Ÿäº§çŽ¯å¢ƒ**å¿…é¡»**ä¿®æ”¹æ‰€æœ‰å¯†é’¥å’Œå®‰å…¨ç›¸å…³é…ç½®

## ðŸ”§ é…ç½®é¡¹è¯´æ˜Ž

### æ•°æ®åº“é…ç½®

#### `DATABASE_URL`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
- **æ ¼å¼**: `file:./path/to/database.db`
- **ç¤ºä¾‹**:
  - å¼€å‘çŽ¯å¢ƒ: `file:./dev.db`
  - ç”Ÿäº§çŽ¯å¢ƒ: `file:/var/www/todo-app/backend/prod.db`
- **æ³¨æ„**: 
  - ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ—¶ï¼Œè·¯å¾„ç›¸å¯¹äºŽé¡¹ç›®æ ¹ç›®å½•
  - ç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„
  - ç¡®ä¿æ•°æ®åº“æ–‡ä»¶æ‰€åœ¨ç›®å½•æœ‰å†™å…¥æƒé™

---

### JWT è®¤è¯é…ç½®

#### `JWT_ACCESS_SECRET`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: Access Token çš„ç­¾åå¯†é’¥
- **å®‰å…¨è¦æ±‚**: 
  - âš ï¸ ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
  - å»ºè®®è‡³å°‘ 32 ä¸ªå­—ç¬¦
  - ä¸è¦ä½¿ç”¨é»˜è®¤å€¼
- **ç”Ÿæˆæ–¹å¼**:
  ```bash
  openssl rand -base64 32
  ```
- **æ³¨æ„**: æ³„éœ²æ­¤å¯†é’¥ä¼šå¯¼è‡´æ‰€æœ‰ Access Token å¤±æ•ˆï¼Œéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•

#### `JWT_REFRESH_SECRET`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: Refresh Token çš„ç­¾åå¯†é’¥
- **å®‰å…¨è¦æ±‚**: 
  - âš ï¸ ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
  - å»ºè®®è‡³å°‘ 32 ä¸ªå­—ç¬¦
  - ä¸è¦ä½¿ç”¨é»˜è®¤å€¼
  - âš ï¸ **å¿…é¡»ä¸Ž `JWT_ACCESS_SECRET` ä¸åŒ**
- **ç”Ÿæˆæ–¹å¼**:
  ```bash
  openssl rand -base64 32
  ```
- **æ³¨æ„**: æ³„éœ²æ­¤å¯†é’¥ä¼šå¯¼è‡´æ‰€æœ‰ Refresh Token å¤±æ•ˆï¼Œéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•

#### `JWT_ACCESS_EXPIRES_IN`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: Access Token çš„è¿‡æœŸæ—¶é—´
- **æ ¼å¼**: æ•°å­— + å•ä½
  - `s` = ç§’
  - `m` = åˆ†é’Ÿ
  - `h` = å°æ—¶
  - `d` = å¤©
- **é»˜è®¤å€¼**: `15m` (15åˆ†é’Ÿ)
- **æŽ¨èå€¼**: 
  - å¼€å‘çŽ¯å¢ƒ: `15m` æˆ– `1h`
  - ç”Ÿäº§çŽ¯å¢ƒ: `15m` (å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ)
- **ç¤ºä¾‹**: 
  - `15m` = 15åˆ†é’Ÿ
  - `1h` = 1å°æ—¶
  - `30s` = 30ç§’

#### `JWT_REFRESH_EXPIRES_IN`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: Refresh Token çš„è¿‡æœŸæ—¶é—´
- **æ ¼å¼**: æ•°å­— + å•ä½ï¼ˆåŒ `JWT_ACCESS_EXPIRES_IN`ï¼‰
- **é»˜è®¤å€¼**: `7d` (7å¤©)
- **æŽ¨èå€¼**: 
  - å¼€å‘çŽ¯å¢ƒ: `7d` æˆ– `30d`
  - ç”Ÿäº§çŽ¯å¢ƒ: `7d` (å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ)
- **ç¤ºä¾‹**: 
  - `7d` = 7å¤©
  - `30d` = 30å¤©
  - `14d` = 14å¤©

---

### æœåŠ¡å™¨é…ç½®

#### `PORT`
- **ç±»åž‹**: æ•°å­—
- **å¿…éœ€**: âŒ å¦ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰
- **é»˜è®¤å€¼**: `3000`
- **è¯´æ˜Ž**: æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·
- **æ³¨æ„**: 
  - å¦‚æžœç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹ä¸ºå…¶ä»–å¯ç”¨ç«¯å£
  - ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰æ—¶ï¼Œé€šå¸¸ä¿æŒ 3000
  - ç¡®ä¿é˜²ç«å¢™å…è®¸è¯¥ç«¯å£è®¿é—®

#### `NODE_ENV`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âŒ å¦ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰
- **é»˜è®¤å€¼**: `development`
- **å¯é€‰å€¼**: 
  - `development` - å¼€å‘çŽ¯å¢ƒ
    - è¯¦ç»†æ—¥å¿—è¾“å‡º
    - é”™è¯¯å †æ ˆä¿¡æ¯
    - çƒ­é‡è½½æ”¯æŒ
  - `production` - ç”Ÿäº§çŽ¯å¢ƒ
    - ç®€åŒ–æ—¥å¿—è¾“å‡º
    - ä¼˜åŒ–æ€§èƒ½
    - éšè—æ•æ„Ÿé”™è¯¯ä¿¡æ¯
  - `test` - æµ‹è¯•çŽ¯å¢ƒ
- **æ³¨æ„**: ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»è®¾ç½®ä¸º `production`

---

### CORS è·¨åŸŸé…ç½®

#### `CORS_ORIGIN`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âœ… æ˜¯
- **è¯´æ˜Ž**: å…è®¸çš„å‰ç«¯åŸŸåï¼ˆCORS è·¨åŸŸèµ„æºå…±äº«ï¼‰
- **æ ¼å¼**: 
  - å•ä¸ªåŸŸå: `http://localhost:5173`
  - å¤šä¸ªåŸŸåï¼ˆé€—å·åˆ†éš”ï¼‰: `http://localhost:5173,https://todo.example.com`
  - å…è®¸æ‰€æœ‰æ¥æºï¼ˆä¸æŽ¨èï¼‰: `*`
- **å¼€å‘çŽ¯å¢ƒ**: `http://localhost:5173` (Vite é»˜è®¤ç«¯å£)
- **ç”Ÿäº§çŽ¯å¢ƒ**: æ‚¨çš„å®žé™…å‰ç«¯åŸŸåï¼Œå¦‚ `https://todo.example.com`
- **å®‰å…¨æ³¨æ„**: 
  - âš ï¸ ç”Ÿäº§çŽ¯å¢ƒä¸è¦ä½¿ç”¨ `*`
  - æ˜Žç¡®æŒ‡å®šå…è®¸çš„åŸŸå
  - ä½¿ç”¨ HTTPS åè®®

---

### æ—¥å¿—é…ç½®ï¼ˆå¯é€‰ï¼‰

#### `LOG_LEVEL`
- **ç±»åž‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: âŒ å¦
- **é»˜è®¤å€¼**: 
  - å¼€å‘çŽ¯å¢ƒ: `debug`
  - ç”Ÿäº§çŽ¯å¢ƒ: `info`
- **å¯é€‰å€¼**ï¼ˆä»Žä½Žåˆ°é«˜ï¼‰:
  - `error` - ä»…é”™è¯¯
  - `warn` - è­¦å‘ŠåŠä»¥ä¸Š
  - `info` - ä¿¡æ¯åŠä»¥ä¸Š
  - `verbose` - è¯¦ç»†ä¿¡æ¯åŠä»¥ä¸Š
  - `debug` - è°ƒè¯•ä¿¡æ¯åŠä»¥ä¸Š
  - `silly` - æ‰€æœ‰æ—¥å¿—
- **æŽ¨èå€¼**:
  - å¼€å‘çŽ¯å¢ƒ: `debug`
  - ç”Ÿäº§çŽ¯å¢ƒ: `info` æˆ– `warn`

---

### å®‰å…¨é…ç½®ï¼ˆå¯é€‰ï¼‰

#### `BCRYPT_ROUNDS`
- **ç±»åž‹**: æ•°å­—
- **å¿…éœ€**: âŒ å¦
- **é»˜è®¤å€¼**: `10`
- **è¯´æ˜Ž**: bcrypt å¯†ç åŠ å¯†çš„è½®æ•°
- **èŒƒå›´**: 4-31
- **è¯´æ˜Ž**: 
  - æ•°å€¼è¶Šå¤§è¶Šå®‰å…¨ï¼Œä½†åŠ å¯†æ—¶é—´è¶Šé•¿
  - 10 æ˜¯æŽ¨èå€¼ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½
  - ç”Ÿäº§çŽ¯å¢ƒå¯ä»¥æé«˜åˆ° 12-14
- **æ³¨æ„**: 
  - ä¿®æ”¹æ­¤å€¼åŽï¼ŒçŽ°æœ‰ç”¨æˆ·çš„å¯†ç éœ€è¦é‡æ–°è®¾ç½®
  - è¿‡é«˜çš„å€¼ï¼ˆ>15ï¼‰å¯èƒ½å¯¼è‡´ç™»å½•å“åº”å˜æ…¢

---

## ðŸ”’ ç”Ÿäº§çŽ¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•

éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒå‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] ä¿®æ”¹ `JWT_ACCESS_SECRET` ä¸ºå¼ºéšæœºå­—ç¬¦ä¸²
- [ ] ä¿®æ”¹ `JWT_REFRESH_SECRET` ä¸ºå¼ºéšæœºå­—ç¬¦ä¸²ï¼ˆä¸Ž Access Secret ä¸åŒï¼‰
- [ ] è®¾ç½® `NODE_ENV=production`
- [ ] é…ç½®æ­£ç¡®çš„ `CORS_ORIGIN`ï¼ˆä¸è¦ä½¿ç”¨ `*`ï¼‰
- [ ] ä½¿ç”¨ HTTPSï¼ˆé…ç½® SSL/TLS è¯ä¹¦ï¼‰
- [ ] æ•°æ®åº“æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬å’Œå½’æ¡£
- [ ] é…ç½®ç›‘æŽ§å’Œå‘Šè­¦
- [ ] å®šæœŸå¤‡ä»½æ•°æ®åº“
- [ ] ä½¿ç”¨çŽ¯å¢ƒå˜é‡ç®¡ç†å·¥å…·ï¼ˆå¦‚ AWS Secrets Manager, HashiCorp Vaultï¼‰

## ðŸ“ çŽ¯å¢ƒå˜é‡ç”Ÿæˆè„šæœ¬

### ç”Ÿæˆ JWT å¯†é’¥

```bash
# ç”Ÿæˆ Access Token å¯†é’¥
echo "JWT_ACCESS_SECRET=\"$(openssl rand -base64 32)\""

# ç”Ÿæˆ Refresh Token å¯†é’¥
echo "JWT_REFRESH_SECRET=\"$(openssl rand -base64 32)\""
```

### ä¸€é”®ç”Ÿæˆå®Œæ•´é…ç½®

```bash
cat > .env << EOF
DATABASE_URL="file:./dev.db"
JWT_ACCESS_SECRET="$(openssl rand -base64 32)"
JWT_REFRESH_SECRET="$(openssl rand -base64 32)"
JWT_ACCESS_EXPIRES_IN="15m"
JWT_REFRESH_EXPIRES_IN="7d"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173"
LOG_LEVEL="debug"
BCRYPT_ROUNDS=10
EOF
```

## ðŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•éªŒè¯çŽ¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®åŠ è½½ï¼Ÿ
A: åœ¨ä»£ç ä¸­æ·»åŠ ä¸´æ—¶æ—¥å¿—ï¼š
```typescript
console.log('JWT_ACCESS_SECRET:', process.env.JWT_ACCESS_SECRET ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®');
```

### Q: çŽ¯å¢ƒå˜é‡ä¿®æ”¹åŽéœ€è¦é‡å¯æœåŠ¡å—ï¼Ÿ
A: æ˜¯çš„ï¼Œä¿®æ”¹ `.env` æ–‡ä»¶åŽéœ€è¦é‡å¯ Node.js æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆã€‚

### Q: å¯ä»¥åœ¨ä»£ç ä¸­ç›´æŽ¥ä½¿ç”¨çŽ¯å¢ƒå˜é‡å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†å»ºè®®ï¼š
- ä½¿ç”¨ `dotenv` åŒ…åŠ è½½ `.env` æ–‡ä»¶
- ä¸ºçŽ¯å¢ƒå˜é‡æä¾›é»˜è®¤å€¼
- éªŒè¯å¿…éœ€çš„çŽ¯å¢ƒå˜é‡æ˜¯å¦å­˜åœ¨

### Q: ç”Ÿäº§çŽ¯å¢ƒå¦‚ä½•ç®¡ç†çŽ¯å¢ƒå˜é‡ï¼Ÿ
A: æŽ¨èæ–¹å¼ï¼š
1. ä½¿ç”¨çŽ¯å¢ƒå˜é‡ç®¡ç†å·¥å…·ï¼ˆAWS Secrets Manager, HashiCorp Vaultï¼‰
2. ä½¿ç”¨å®¹å™¨ç¼–æŽ’å·¥å…·çš„çŽ¯å¢ƒå˜é‡åŠŸèƒ½ï¼ˆDocker, Kubernetesï¼‰
3. ä½¿ç”¨ CI/CD å¹³å°çš„çŽ¯å¢ƒå˜é‡é…ç½®
4. é¿å…å°†æ•æ„Ÿä¿¡æ¯æäº¤åˆ°ä»£ç ä»“åº“

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [Prisma çŽ¯å¢ƒå˜é‡æ–‡æ¡£](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#env)
- [JWT æœ€ä½³å®žè·µ](https://tools.ietf.org/html/rfc8725)
- [bcrypt å®‰å…¨å»ºè®®](https://github.com/kelektiv/node.bcrypt.js#readme)

